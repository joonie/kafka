# 카프카(Kafka) 학습



## 카프카 기초 이론

------



- 카프카 용어 정리

  - 브로커 : 카프카 애플리케이션이 설치되어있는 서버 또는 노드
  - 토픽 : 프로듀서와 컨슈머들이 카프카로 보낸 자신들의 메세지를 구분하기 위한 네임
  - 파티션 : 병렬처리가 가능하도록 토픽을 나눈 것
  - 리플리케이션 펙터 : 복제본 숫자

  

- 토픽의 이해

  - 카프카는 토픽이라 불리는 곳에 저장하며 메일주소라고 보면 이해하기 쉽다.
  - 249자 미만으로 영문, 숫자, '.', '_', '-'를 조합하여 자유롭게 만들 수 있다.

  

- 파티션의 이해

  - 파티셔닝을 너무 많이 할 경우

    - 장애복구 시간의 증가
    - 파티셔닝이 많아 질수록 파티션이 사용하는 파일 핸들러가 많아져 리소스 낭비가 발생

  - 적절한 파티션의 개수는?

    - 4대 정도로 프로듀서, 컨슈머 구성을 해보고 처리 성능, 병목현상 등을 봐가면서 프로듀서와 컨슈머의 개수를 늘린다
    - 파티션의 증가는 아무때나 가능하지만 파티션을 줄이는 방법은 토픽을 삭제하고 다시 만드는 방법 밖에 없다.
    - 브로커당 2000개의 파티션 수를 권장한다.

    

- 브로커 모두 장애에 빠지는 경우

  - (디폴트) 마지막 리더가 살아나기를 기다린다

    - 마지막 리더는 (=가장 늦게 죽은 브로커)가 살아나면 메세지 손실 없이 복구가 가능

  - 브로커가 죽으면서 ISR에서 추방당했지만 먼저 살아난 브로커가 ISR로 편입되면서 리더가 된다.

    - 가장 먼저 죽은 브로커가 맨 먼저 살아나 리더가 되면 마지막에 죽은 브로커가 받았던 메세지들을 손실된다.

    

- 카프카 생성

  - 카프카 클러스터 중 한 대에 접속한 뒤 <u>토픽 추가</u>

  - ```shell
    > Kafka-topics.sh --zookeeper peter-zk001:2181,peter-zk002:2181,peter-zk003:2181/peter-kafka --replication-factor 1 --partitions 1 --topic peter-topic --create
    
    > Created topic "peter-topic"
    ```

  - <u>토픽 삭제</u>

    ```sh
    Kafka-topics.sh --zookeeper peter-zk001:2181,peter-zk002:2181,peter-zk003:2181/peter-kafka --topic Peter-topic --delete
    
    >Topic peter-topic is marked for deletion
    ```

  - <u>토픽 조회</u>

    ```sh
    Kafka-topics.sh --zookeeper peter-zk001:2181,peter-zk002:2181,peter-zk003:2181/peter-kafka --topic Peter-topic --describe
    ```

    

  


